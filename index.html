<html>
  <head>
    <title>City Builder</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <canvas id="canvas"></canvas>

    <div id="selector">
      <div id="option">
        <div onclick="tabChange(this)">Move</div>
        <div onclick="tabChange(this)">Road</div>
        <div onclick="tabChange(this)">Object</div>
        <div onclick="tabChange(this)">Trees</div>
        <div onclick="tabChange(this)">Building</div>
      </div>
      <div id="obj" class="your-div">
      </div>
    </div>
    <div id="constructionline"></div>

    <script src="uitask.js"></script>
    <script src="vector.js"></script>
    <script src="util.js"></script>
    <script src="road.js"></script>
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const camera = { x: 0, y: 0 };
      let mouseDown = false;
      let mousePositionStore = {
        down: {},
        up: {},
        move: { x: 0, y: 0 },
        difference: { x: 0, y: 0 },
      };

      let road = new Road();

      function animation() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        road.draw(ctx, camera, Tab, {
          x: mousePositionStore.move.x - camera.x,
          y: mousePositionStore.move.y - camera.y,
          w:selectedRoad.width
        });
        requestAnimationFrame(animation);
      }
      animation();

      canvas.addEventListener("mousedown", (e) => {
        if (Tab == "Road") {
          road.createStartSegment(e.x - camera.x, e.y - camera.y,selectedRoad.width,selectedRoad.color);
        }
        mouseDown = true;
        mousePositionStore.down = { x: e.x, y: e.y };
      });

      canvas.addEventListener("mouseup", (e) => {
        if (Tab == "Road") {
          road.createEndSegment(e.x - camera.x, e.y - camera.y,selectedRoad.width,selectedRoad.color);
        }
        mouseDown = false;
        mousePositionStore.up = { x: e.x, y: e.y };
        if (Tab == "Move") {
          camera.x =
            e.x - mousePositionStore.down.x + mousePositionStore.difference.x;
          camera.y =
            e.y - mousePositionStore.down.y + mousePositionStore.difference.y;
          mousePositionStore.difference.x = camera.x;
          mousePositionStore.difference.y = camera.y;
        }
      });

      canvas.addEventListener("mousemove", (e) => {
        mousePositionStore.move.x = e.x;
        mousePositionStore.move.y = e.y;
        if (Tab == "Road") {
          if (mouseDown) {
            road.createEndSegmentMove(e.x - camera.x, e.y - camera.y,selectedRoad.width,selectedRoad.color);
          }
        }
        if (mouseDown && Tab == "Move") {
          camera.x =
            e.x - mousePositionStore.down.x + mousePositionStore.difference.x;
          camera.y =
            e.y - mousePositionStore.down.y + mousePositionStore.difference.y;
        }
      });
    </script>
  </body>
</html>
