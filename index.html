<html>
  <head>
    <title>City Builder</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <canvas id="canvas"></canvas>

    <div id="selector">
      <div id="option">
        <div onclick="tabChange(this)">Move</div>
        <div onclick="tabChange(this)">Road</div>
        <div onclick="tabChange(this)">Object</div>
        <div onclick="tabChange(this)">Trees</div>
        <div onclick="tabChange(this)">Building</div>
      </div>
      <div id="obj" class="your-div"></div>
    </div>
    <div id="constructionline"></div>

    <script src="uitask.js"></script>
    <script src="vector.js"></script>
    <script src="util.js"></script>
    <script src="./road/Circle.js"></script>
    <script src="./road/segment.js"></script>
    <script src="./road/zone.js"></script>
    <script src="./road/road.js"></script>
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      mouse = {
        down: { x: 0, y: 0, is: false },
        move: { x: 0, y: 0 },
        up: { x: 0, y: 0 },
        zoom: 1,
        drag: false,
        offset: { x: 0, y: 0 },
      };

      let center={x:canvas.width/2,y:canvas.height/2}
      let Offset = { x: center.x*-1, y: center.y*-1 };
      
      road = new Road();

      function animation() {
        let offset = {
          x: Offset.x + mouse.offset.x,
          y: Offset.y + mouse.offset.y,
        };
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(center.x,center.y);
        ctx.scale(1 / mouse.zoom, 1 / mouse.zoom);
        ctx.translate(offset.x, offset.y);
        road.draw(ctx,mouse.move);
        ctx.restore();
        requestAnimationFrame(animation);
      }
      animation();

      canvas.addEventListener("mousedown", (e) => {
        if (e.button == 1) {
          mouse.down = {
            x: (e.clientX - center.x) * mouse.zoom - Offset.x,
            y: (e.clientY - center.y) * mouse.zoom - Offset.y,
          };
          mouse.drag = true;
        } else {
          road.createStartSegment((e.clientX - center.x) * mouse.zoom - Offset.x, (e.clientY - center.y) * mouse.zoom - Offset.y);
          mouse.down.is = true;
        }
      });

      canvas.addEventListener("mousemove", (e) => {
        mouse.move = {
             x: (e.clientX - center.x) * mouse.zoom - Offset.x,
            y: (e.clientY - center.y) * mouse.zoom - Offset.y,
          };
        if (mouse.down.is) {
          road.createEndSegmentMove(
            (e.clientX - center.x) * mouse.zoom - Offset.x, (e.clientY - center.y) * mouse.zoom - Offset.y
          );
        }
        if (mouse.drag) {
          
          mouse.offset = {
            x: mouse.move.x - mouse.down.x,
            y: mouse.move.y - mouse.down.y,
          };
        }
      });
      canvas.addEventListener("mouseup", (e) => {
        if (mouse.down.is) {
          road.createEndSegment((e.clientX - center.x) * mouse.zoom - Offset.x, (e.clientY - center.y) * mouse.zoom - Offset.y);
          mouse.down.is = false;
        }
        if (mouse.drag) {
          Offset = {
            x: Offset.x + mouse.offset.x,
            y: Offset.y + mouse.offset.y,
          };
          let zoom=mouse.zoom
          mouse = {
            down: { x: 0, y: 0, is: false },
            move: { x: 0, y: 0 },
            up: { x: 0, y: 0 },
            zoom: zoom,
            drag: false,
            offset: { x: 0, y: 0 },
          };
        }
      });
      canvas.addEventListener("mousewheel", (e) => {
        let dir = Math.sign(e.deltaY);
        mouse.zoom += dir * 0.1;
        mouse.zoom = Math.max(1, Math.min(5, mouse.zoom));
      });
    </script>
  </body>
</html>
