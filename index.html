<html>
  <head>
    <title>City Builder</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <select onchange="tabChange(this)">
      <option value="move">move</option>
      <option value="road">Road</option>
    </select>

    <script src="uitask.js"></script>
    <script src="vector.js"></script>
    <script src="util.js"></script>
    <script src="road.js"></script>
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const camera = { x: 0, y: 0 };

      let road = new Road();

      function animation() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        road.draw(ctx, camera,(Tab=="road")?true:false);
        requestAnimationFrame(animation);
      }
      animation();

      let mouseDown = false;
      let mousePositionStore = { down: {}, up: {}, difference: {x:0,y:0} };

      canvas.addEventListener("mousedown", (e) => {
        if (Tab!="move") {
          road.createStartSegment(e.x-camera.x, e.y-camera.y);
        }
        mouseDown = true;
        mousePositionStore.down = { x: e.x, y: e.y };
      });

      canvas.addEventListener("mouseup", (e) => {
        if (Tab!="move") {
          road.createEndSegment(e.x-camera.x, e.y-camera.y);
        }
        mouseDown = false;
        mousePositionStore.up = { x: e.x, y: e.y };
        if (Tab=="move") {
          camera.x = e.x - mousePositionStore.down.x + mousePositionStore.difference.x
          camera.y = e.y - mousePositionStore.down.y + mousePositionStore.difference.y
          mousePositionStore.difference.x=camera.x
          mousePositionStore.difference.y=camera.y
        }
      });

      canvas.addEventListener("mousemove", (e) => {
        if (Tab!="move") {
          if (mouseDown) {
            road.createEndSegmentMove(e.x-camera.x, e.y-camera.y);
          }
        }
        if (mouseDown && Tab=="move") {
          camera.x = e.x - mousePositionStore.down.x + mousePositionStore.difference.x;
          camera.y = e.y - mousePositionStore.down.y + mousePositionStore.difference.y;
        }
      });

      
      
    </script>
  </body>
</html>
