<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Procedural Island Generator</title>
    <style>
      body {
        margin: 0;
        background: #111;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      canvas {
        border: 2px solid #333;
        image-rendering: pixelated;
      }
    </style>
  </head>
  <body>
    <canvas id="map" width="500" height="500"></canvas>

    <script>
      // ==========================
      // üéõÔ∏è USER CONTROLS
      // ==========================
      const WATER_LEVEL = 0.22; // ‚Üë more sea
      const SAND_SIZE = 0.02; // beach thickness
      const FOREST_DENSITY = 0.25; // ‚Üì more forest
      const FERTILE_DENSITY = 0.3; // ‚Üì more fertile land
      const OIL_DENSITY = 0.7; // ‚Üì more oil areas

      // ==========================
      // NOISE FUNCTIONS
      // ==========================
      function rand(x, y, seed) {
        return (
          Math.abs(
            Math.sin(x * 127.1 + y * 311.7 + seed * 101.3) * 43758.5453
          ) % 1
        );
      }

      function lerp(a, b, t) {
        return a + (b - a) * t;
      }

      function smooth(t) {
        return t * t * (3 - 2 * t);
      }

      function noise2D(x, y, seed) {
        const x0 = Math.floor(x);
        const x1 = x0 + 1;
        const y0 = Math.floor(y);
        const y1 = y0 + 1;

        const sx = smooth(x - x0);
        const sy = smooth(y - y0);

        const n00 = rand(x0, y0, seed);
        const n10 = rand(x1, y0, seed);
        const n01 = rand(x0, y1, seed);
        const n11 = rand(x1, y1, seed);

        const ix0 = lerp(n00, n10, sx);
        const ix1 = lerp(n01, n11, sx);

        return lerp(ix0, ix1, sy);
      }

      // ==========================
      // MAP GENERATOR
      // ==========================
      function generateIslandMap(width, height, seed = Math.random() * 9999) {
        const map = [];

        const scale = 0.08;
        const forestScale = 0.15;
        const fertileScale = 0.12;
        const oilScale = 0.1;

        const cx = width / 2;
        const cy = height / 2;
        const maxDist = Math.sqrt(cx * cx + cy * cy);

        for (let y = 0; y < height; y++) {
          map[y] = [];
          for (let x = 0; x < width; x++) {
            // Base height
            const n = noise2D(x * scale, y * scale, seed);

            // Island falloff
            const dx = x - cx;
            const dy = y - cy;
            const falloff = 1 - Math.sqrt(dx * dx + dy * dy) / maxDist;

            const h = n * falloff;
            let tile;

            // üåä Sea
            if (h < WATER_LEVEL) {
              tile = 0;
            }
            // üèñ Sand
            else if (h < WATER_LEVEL + SAND_SIZE) {
              tile = 1;
            } else {
              tile = 2; // grass (default)

              // üå± Fertile land (low-mid elevation)
              const fertileNoise = noise2D(
                x * fertileScale,
                y * fertileScale,
                seed + 555
              );
              if (fertileNoise > FERTILE_DENSITY && h < 0.5) {
                tile = 4;
              }

              // üå≤ Forest (higher elevation)
              const forestNoise = noise2D(
                x * forestScale,
                y * forestScale,
                seed + 999
              );
              if (forestNoise > FOREST_DENSITY && h > 0.45) {
                tile = 3;
              }

              // üõ¢ Oil fields (dry & flat)
              const oilNoise = noise2D(x * oilScale, y * oilScale, seed + 777);
              if (oilNoise > OIL_DENSITY && h > 0.4 && h < 0.6) {
                tile = 5;
              }
            }

            map[y][x] = tile;
          }
        }
        return map;
      }

      // ==========================
      // DRAW MAP
      // ==========================
      const canvas = document.getElementById("map");
      const ctx = canvas.getContext("2d");

      const tileSize = 5;
      const mapWidth = canvas.width / tileSize;
      const mapHeight = canvas.height / tileSize;

      const map = generateIslandMap(mapWidth, mapHeight);

      for (let y = 0; y < mapHeight; y++) {
        for (let x = 0; x < mapWidth; x++) {
          switch (map[y][x]) {
            case 0:
              ctx.fillStyle = "#1e90ff";
              break; // water
            case 1:
              ctx.fillStyle = "#f4d03f";
              break; // sand
            case 2:
              ctx.fillStyle = "#2ecc71";
              break; // grass
            case 3:
              ctx.fillStyle = "#145a32";
              break; // forest
            case 4:
              ctx.fillStyle = "#7CFC98";
              break; // fertile
            case 5:
              ctx.fillStyle = "#8B4513";
              break; // oil
          }

           ctx.fillRect(
             x * tileSize,
             y * tileSize,
             tileSize,
             tileSize
           );
          // ctx.beginPath();
          // ctx.arc(
          //   x * tileSize + tileSize / 2,
          //   y * tileSize + tileSize / 2,
          //   tileSize ,
          //   0,
          //   Math.PI * 2
          // );
          // ctx.fill();
        }
      }
    </script>
  </body>
</html>
